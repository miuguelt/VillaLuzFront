version: '3.9'

services:
  web:
    container_name: finca_frontend
    build:
      context: .                   # Carpeta del proyecto Vite
      dockerfile: Dockerfile       # Dockerfile del frontend
      args:
        VITE_RUNTIME_ENV: ${VITE_RUNTIME_ENV}
        VITE_API_BASE_URL: ${VITE_API_BASE_URL}
        VITE_API_BASE_URL_NO_VERSION: ${VITE_API_BASE_URL_NO_VERSION}
        VITE_FRONTEND_URL: ${VITE_FRONTEND_URL}
        VITE_DEBUG_MODE: ${VITE_DEBUG_MODE}
    ports:
      - "80:80"
    restart: unless-stopped

    environment:
      # Entorno general
      VITE_RUNTIME_ENV: ${VITE_RUNTIME_ENV}
      VITE_DEBUG_MODE: ${VITE_DEBUG_MODE}
      VITE_ENABLE_PWA_PREFETCH: ${VITE_ENABLE_PWA_PREFETCH}

      # Backend interno (Flask)
      VITE_BACKEND_HOST: ${VITE_BACKEND_HOST}
      VITE_BACKEND_PORT: ${VITE_BACKEND_PORT}
      VITE_BACKEND_PROTOCOL: ${VITE_BACKEND_PROTOCOL}
      VITE_API_BASE_URL: ${VITE_API_BASE_URL}
      VITE_API_BASE_URL_NO_VERSION: ${VITE_API_BASE_URL_NO_VERSION}

      # Frontend (actual)
      VITE_FRONTEND_HOST: ${VITE_FRONTEND_HOST}
      VITE_FRONTEND_PORT: ${VITE_FRONTEND_PORT}
      VITE_FRONTEND_PROTOCOL: ${VITE_FRONTEND_PROTOCOL}
      VITE_FRONTEND_URL: ${VITE_FRONTEND_URL}

      # CORS y cookies
      VITE_CORS_ALLOWED_ORIGINS: ${VITE_CORS_ALLOWED_ORIGINS}
      VITE_USE_COOKIES: ${VITE_USE_COOKIES}
      VITE_COOKIE_DOMAIN: ${VITE_COOKIE_DOMAIN}
      VITE_COOKIE_SECURE: ${VITE_COOKIE_SECURE}
      VITE_COOKIE_SAMESITE: ${VITE_COOKIE_SAMESITE}

    networks:
      coolify:
        aliases:
          - mifinca
      redbd:
        aliases:
          - mifinca

networks:
  coolify:
    external: true
  redbd:
    external: true
